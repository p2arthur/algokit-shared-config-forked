name: "Setup Node.js and Authentication"
description: "Checks out code, sets up Node.js, and configures NPM/GitHub auth for private packages."

inputs:
  node-version:
    description: "The Node.js version to use."
    required: false
    default: "20.x"
  working-directory:
    description: "The working directory for subsequent steps."
    required: false
    default: "."
  NPM_TOKEN:
    description: "NPM auth token for private package access."
    required: true
  GITHUB_TOKEN:
    description: "GITHUB_TOKEN for checkout and GitHub package access."
    required: true

runs:
  using: "composite"
  steps:
    - name: âš™ï¸ Checkout Repository
      uses: actions/checkout@v4
      with:
        token: ${{ inputs.GITHUB_TOKEN }} # Use the provided token for private repo checkout
        fetch-depth: 0

    - name: ğŸŸ¢ Set up Node.js ${{ inputs.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node-version }}
        cache: "npm"
        cache-dependency-path: ${{ inputs.working-directory }}/package-lock.json

    - name: ğŸ”‘ Configure NPM Auth
      shell: bash
      run: |
        # Use the dedicated NPM token to create the .npmrc file
        echo "//npm.pkg.github.com/:_authToken=${{ inputs.NPM_TOKEN }}" > .npmrc
